<!DOCTYPE html>
<html>
<head>
    <title>Admin - Bikaner Fresh</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-4">
        <h3 class="text-success fw-bold text-center">Bikaner Admin Panel</h3>
        <hr>

        <div class="card p-3 mb-4 shadow-sm border-primary">
            <h6 class="fw-bold">üì¢ Live Mandi Bhav Patti</h6>
            <div class="input-group">
                <input type="text" id="m-in" class="form-control" placeholder="Aloo 20, Pyaaz 30...">
                <button onclick="updM()" class="btn btn-primary">Update</button>
            </div>
        </div>

        <div class="card p-3 mb-4 shadow-sm">
            <h6 class="fw-bold">‚ûï Nayi Sabzi Add Karein</h6>
            <div class="row g-2">
                <div class="col-6"><input type="text" id="n" placeholder="Name" class="form-control"></div>
                <div class="col-3"><input type="number" id="p" placeholder="Price" class="form-control"></div>
                <div class="col-3"><button onclick="add()" class="btn btn-success w-100">Add</button></div>
            </div>
        </div>

        <div id="list"></div>
    </div>

    <script>
        async function updM() {
            const m = document.getElementById('m-in').value;
            await fetch('/api/settings/update', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ message: m }) });
            alert("Ticker Updated!");
        }

        async function load() {
            const res = await fetch('/api/products');
            const data = await res.json();
            let h = '';
            data.forEach(x => {
                h += `<div class="card p-3 mb-2 d-flex flex-row justify-content-between align-items-center shadow-sm">
                        <b>${x.name}</b>
                        <span>‚Çπ${x.price}/${x.unit}</span>
                        <button onclick="del('${x._id}')" class="btn btn-danger btn-sm">üóëÔ∏è</button>
                      </div>`;
            });
            document.getElementById('list').innerHTML = h || '<p class="text-center">No Products. Add from above!</p>';
        }

        async function add() {
            const body = { name: document.getElementById('n').value, price: document.getElementById('p').value, unit: 'kg' };
            await fetch('/api/products/add', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body) });
            location.reload();
        }

        async function del(id) {
            if(confirm("Delete?")) { await fetch(`/api/products/delete/${id}`, { method: 'DELETE' }); load(); }
        }
        load();
    </script>
</body>
</html>
