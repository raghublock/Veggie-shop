<!DOCTYPE html>
<html>
<head>
    <title>Bikaner Fresh Veggies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places"></script>
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .order-card { max-width: 500px; margin: 20px auto; padding: 25px; border-radius: 20px; border: none; }
        .product-item { background: #ffffff; border-radius: 12px; padding: 12px; margin-bottom: 10px; border-left: 5px solid #198754; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .hindi-name { font-size: 0.9rem; color: #198754; font-weight: 500; }
        .btn-add { background-color: #198754; color: white; border: none; padding: 5px 15px; border-radius: 8px; font-weight: bold; }
        .qty-btn { width: 30px; height: 30px; border-radius: 50%; border: 1px solid #ddd; background: white; font-weight: bold; cursor: pointer; }
        .qr-box { border: 2px dashed #198754; padding: 15px; border-radius: 15px; background: #fff; display: none; margin-top: 15px; }
        .pac-container { border-radius: 10px; margin-top: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); } /* Suggestion box style */
    </style>
</head>
<body>
    <div class="container">
        <div class="card order-card shadow-lg">
            <h2 class="text-center text-success fw-bold">Bikaner Fresh Veggies</h2>
            <p class="text-center text-muted small">Mandi se seedha aapke ghar tak</p>
            <hr>
            
            <div id="login-section">
                <div class="mb-2">
                    <label class="small fw-bold">Mobile Number</label>
                    <input type="number" id="mobile" placeholder="98290XXXXX" class="form-control py-2">
                </div>
                
                <div class="mb-2">
                    <label class="small fw-bold text-danger">Delivery Address (Search karein)</label>
                    <input id="address" type="text" placeholder="Gali, Mohalla ya Landmark search karein..." class="form-control">
                    <small class="text-muted" style="font-size: 0.7rem;">üìç Type karte hi Google aapka area dhoond lega</small>
                </div>

                <div class="mb-3">
                    <label class="small fw-bold text-primary">Delivery Kab Chahiye?</label>
                    <select id="delivery-type" class="form-select border-primary" onchange="updateCartUI()">
                        <option value="today">Aaj hi (Cash on Delivery)</option>
                        <option value="future">Future Booking (60% Advance)</option>
                    </select>
                </div>
                <button onclick="checkLocation()" class="btn btn-primary w-100 fw-bold py-2 shadow-sm">Confirm & Shop Now</button>
            </div>
            
            <p id="status-msg" class="mt-3 text-center fw-bold"></p>
            <div id="product-list" class="mt-4"></div>
            
            <div id="checkout-section" style="display:none;" class="mt-4 border-top pt-3">
                <h6 class="fw-bold mb-3">Aapka Cart</h6>
                <div id="cart-details" class="mb-3"></div>
                <div class="d-flex justify-content-between align-items-center bg-light p-2 rounded mb-2">
                    <span class="fw-bold">Total Bill:</span>
                    <span class="fw-bold text-success fs-5">‚Çπ<span id="cart-total">0</span></span>
                </div>
                
                <div id="advance-display-box" class="qr-box text-center">
                    <h6 class="text-warning fw-bold">Advance Payment (60%): ‚Çπ<span id="advance-amt">0</span></h6>
                    <img id="qr-img" src="" alt="UPI QR Code" class="img-fluid mb-2 border p-2 bg-white" style="max-width: 180px;">
                    <p class="fw-bold small text-dark">UPI: 8740871855@ptsbi</p>
                </div>
                
                <button onclick="sendOrder()" class="btn btn-warning w-100 fw-bold py-3 shadow mt-3">Confirm Order on WhatsApp</button>
            </div>
        </div>
    </div>

    <script>
        let cart = [];
        let productsData = [];

        // --- GOOGLE AUTOCOMPLETE JUGAD ---
        function initAutocomplete() {
            const input = document.getElementById('address');
            // Bikaner ke coordinates pe focus karne ke liye
            const options = {
                componentRestrictions: { country: "in" },
                fields: ["address_components", "geometry", "icon", "name"],
                strictBounds: false,
            };
            const autocomplete = new google.maps.places.Autocomplete(input, options);
        }
        google.maps.event.addDomListener(window, 'load', initAutocomplete);

        async function loadProducts() {
            const list = document.getElementById('product-list');
            try {
                const res = await fetch('/api/products');
                productsData = await res.json();
                let html = '<h6 class="fw-bold mb-3 text-secondary">Taaza Sabziyan (Fresh Veggies):</h6>';
                productsData.forEach(p => {
                    // Products list mein Hindi naam add kiya
                    html += `<div class="d-flex justify-content-between align-items-center product-item">
                                <div>
                                    <span class="fw-bold">${p.name}</span> <span class="hindi-name">(${p.hindiName || '‡§∏‡§¨‡•ç‡§ú‡•Ä'})</span><br>
                                    <small class="text-muted">‚Çπ${p.price}/${p.unit || 'kg'}</small>
                                </div>
                                <button onclick="addToCart('${p._id}')" class="btn-add">Add +</button>
                             </div>`;
                });
                list.innerHTML = html;
                document.getElementById('checkout-section').style.display = 'block';
            } catch (err) { }
        }

        // --- BAAKI LOGIC SAME RHEGA (Add to cart, Update UI with Auto-QR) ---
        function updateCartUI() {
            const cartDetails = document.getElementById('cart-details');
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryType = document.getElementById('delivery-type').value;
            
            let html = '';
            cart.forEach(item => {
                html += `<div class="d-flex justify-content-between align-items-center p-2">
                            <span><b>${item.name}</b> (${item.quantity}${item.unit || 'kg'})</span>
                            <div class="d-flex align-items-center">
                                <button class="qty-btn" onclick="changeQuantity('${item._id}', -1)">-</button>
                                <span class="mx-2">${item.quantity}</span>
                                <button class="qty-btn" onclick="changeQuantity('${item._id}', 1)">+</button>
                            </div>
                         </div>`;
            });
            cartDetails.innerHTML = html;
            document.getElementById('cart-total').innerText = total;

            if (deliveryType === 'future' && total > 0) {
                const advanceAmount = (total * 0.6).toFixed(2);
                document.getElementById('advance-display-box').style.display = 'block';
                document.getElementById('advance-amt').innerText = advanceAmount;
                const upiLink = `upi://pay?pa=8740871855@ptsbi&pn=BikanerFreshVeggies&am=${advanceAmount}&cu=INR`;
                document.getElementById('qr-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiLink)}`;
            } else {
                document.getElementById('advance-display-box').style.display = 'none';
            }
        }
        // ... (changeQuantity, checkLocation, sendOrder same as before)
    </script>
</body>
</html>
